<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Create Base WAF Child Policy</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Create Base WAF Child Policy"/>
  <meta name="product" content="WAF - Identifying the level of protection required for applications"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2021-04-20 05:07:53"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="WAF - Identifying the level of protection required for applications" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Create Base WAF Child Policy &#8212; WAF - Identifying the level of protection required for applications  documentation</title>
    <link rel="stylesheet" href="../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Update Parent WAF Policy" href="update-parent.html" />
    <link rel="prev" title="Create WAF Parent Policy" href="create-parent.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>WAF - Identifying the level of protection required for applications  </h5>
        

        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="class01.html">WAF - Identifying the level of protection required for applications</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Create Base WAF Child Policy</a></li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../index.html">WAF - Identifying the level of protection required for applications</a>
              &gt; <a href="class01.html">WAF - Identifying the level of protection required for applications</a>

          <span class="right">
             <a href="../_sources/class01/create-child.rst.txt" rel="nofollow">Source</a> |
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="create-base-waf-child-policy">
<h1>Create Base WAF Child Policy<a class="headerlink" href="#create-base-waf-child-policy" title="Permalink to this headline">Â¶</a></h1>
<p>In this section you will create child profile based on the parent profile <strong>waf_base</strong> without any additional customizations.  This would be consistent with setting a base profile that could be used across multiple applications in your environment.</p>
<p><strong>Task 1 - Simulate attacks to demonstrate common web app vulnerabilities.</strong></p>
<p>You are going to open a browser window and simulate attacks against the, as of yet, unprotected Hackazon application.  You have two options for logging into the <strong>ubu-jumpbox</strong>, one is Microsoft Remote Desktop, <strong>XRDP</strong>, the other is <strong>CONSOLE</strong> which opens up the Linux GUI in a new browser window/tab.</p>
<p>You only access to a browser running on the jumpbox, the suggested method for this task is to use the <strong>CONSOLE</strong> access method.</p>
<ol class="arabic">
<li><p class="first">Choose Your access method and at the login, select <strong>f5student</strong> as the user and use <strong>f5UDFrocks!</strong> as the password.</p>
</li>
<li><p class="first">Select <strong>Applications</strong> in the upper left-hand corner and from the drop-down menu select <strong>Internet</strong> and then <strong>Chromium Web Browser</strong>.</p>
</li>
<li><p class="first">Open browser and go to <span class="guilabel">http://&lt;f5student#-ext-pip0&gt;</span> to access the <strong>Hackazon</strong> website</p>
</li>
<li><p class="first">Under <strong>Special selection</strong> click on any sale item displayed</p>
</li>
<li><p class="first">Note the <strong>product id</strong> in the browser address bar</p>
<a class="reference internal image-reference" href="../_images/image392.png"><img alt="../_images/image392.png" src="../_images/image392.png" style="height: 400px;" /></a>
</li>
<li><p class="first">In the browser address bar append <span class="guilabel">or 1=1</span> then press <strong>Enter</strong></p>
<a class="reference internal image-reference" href="../_images/image393.png"><img alt="../_images/image393.png" src="../_images/image393.png" style="height: 50px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is a common <span class="guilabel">sql injection</span> attack and although this did not return
anything exciting the search request was accepted and processed with response.</p>
</div>
</li>
<li><p class="first">In the <strong>Search field</strong> enter <span class="guilabel">&lt;script&gt;alert(&quot;Your system is infected! Call 999-888-7777 for help.&quot;)&lt;/script&gt;</span> and press <strong>Enter</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This is a common <span class="guilabel">Cross-site scripting (XSS)</span> attack and although this did not return
anything exciting the search request was accepted and processed with response.</p>
<p class="last">Also some modern versions of browsers will block this request from displaying a response, but the request was actually sent to the application.  If Chrome blocks it you can try on another browser.</p>
</div>
</li>
</ol>
<p><strong>Task 2 - Create new waf policy to mitigate the vulnerabilities using info on table below:</strong></p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Policy Name</strong></td>
<td>waf_baseOnly</td>
</tr>
<tr class="row-even"><td><strong>Policy Type</strong></td>
<td>Security</td>
</tr>
<tr class="row-odd"><td><strong>Parent Policy</strong></td>
<td>waf_base</td>
</tr>
<tr class="row-even"><td><strong>Virtual Server</strong></td>
<td>hackazon_vs</td>
</tr>
<tr class="row-odd"><td><strong>Logging Profiles</strong></td>
<td>waf_log</td>
</tr>
<tr class="row-even"><td><strong>Enforcement Mode</strong></td>
<td>Blocking</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li>Select the <strong>Security-&gt;Application Security-&gt;Security Policies-&gt;Policies List</strong> page</li>
<li>Click <strong>Create New Policy</strong></li>
<li>For <strong>Policy Name</strong> enter <span class="guilabel">waf_base_Only</span></li>
<li>For <strong>Policy Type</strong> select <span class="guilabel">Security</span></li>
<li>For <strong>Parent Policy</strong> enter <span class="guilabel">waf_base</span></li>
<li>You will get a warning noting select a parent policy may change other settings. Review the setting selections and then select <strong>OK</strong> to accept warning.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will note that many of the selections are now greyed out because those selections are based on the parent policy.</p>
</div>
<ol class="arabic">
<li><p class="first">For <strong>Virtual Server</strong> select <span class="guilabel">hackazon_vs</span></p>
</li>
<li><p class="first">For <strong>Logging Profiles</strong> select <strong>waf_log</strong>.</p>
</li>
<li><p class="first">Change <strong>Enforcement Mode</strong> to <span class="guilabel">Blocking</span></p>
<a class="reference internal image-reference" href="../_images/image311.png"><img alt="../_images/image311.png" src="../_images/image311.png" style="height: 400px;" /></a>
</li>
<li><p class="first">Click <strong>Save</strong> in the upper left to save your new policy.</p>
</li>
</ol>
<p>Whoops! It seems that we ran into an issue.  Go to <a class="reference external" href="https://askf5.com">https://askf5.com</a> and enter the basic error message <strong>Could not update the Policy. Inherited values may not be changed.</strong> into the search box.</p>
<a class="reference internal image-reference" href="../_images/image310a.png"><img alt="../_images/image310a.png" src="../_images/image310a.png" style="height: 300px;" /></a>
<p>As you look at the results you should find <strong>Bug ID 986937: Cannot create child policy when the signature staging setting is not equal in template and parent policy</strong>.  Open the Bug ID <a class="reference external" href="https://cdn.f5.com/product/">https://cdn.f5.com/product/</a>
bugtracker/ID986937.html and check the bug <em>Conditions</em> and <em>Workaround</em>.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Staging is used to watch new policy changes, like updated signatures, in transparent mode for a defined period of time and will alarm and log, but not block violations.  This allows the WAF administrator time to determine if the new signatures are creating false positives.  In most circumstances you would not disable signature staging. While the lab could have been modified to avoid you seeing the bug we felt this was a good learning experience and a way for you to see bug tracker.</p>
</div>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Let's implement the workaround by removing the parent policy. Click <strong>Save</strong> in the upper left to save your new policy.</p>
</li>
<li><p class="first">Under <strong>Security Policy Configuration</strong> on the left select <strong>Inheritance Settings</strong></p>
</li>
<li><p class="first">Next to <strong>Parent Policy</strong> click on the drop-down menu and select <strong>waf_base</strong>, then select <strong>Save</strong> on the upper right.  You will now see the <strong>Inheritance Settings</strong>.</p>
</li>
<li><p class="first">Select <strong>General Settings</strong> on the left and you will see most selections are now greyed out as the parent policy controls these security features.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As you can now see, parent profiles can be used to change existing profiles.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This creates a child security policy which inherits the settings from the
waf_base Parent Policy.  The parent policy settings was created using Rapid
Deployment Template which includes several common security measures and uses
<strong>Server Technologies</strong> for attack signatures (see <a class="reference external" href="https://techdocs.f5.com/en-us/bigip-15-0-0/big-ip-asm-implementations/adding-server-technologies-to-a-policy.html">Manual Chapter - Adding Server Technologies to a Policy</a> for more information). Signature Staging is Disabled for this lab demo but it is enabled by default and should be enabled for production environments.</p>
</div>
</li>
</ol>
<p><strong>Task 3 - Test WAF policy.</strong></p>
<p>Now let's review the security policies on our virtual server and test our new WAF policy.</p>
<ol class="arabic">
<li><p class="first">Select the <strong>Local Traffic-&gt;Virtual Servers-&gt;Virtual Servers List</strong> page</p>
</li>
<li><p class="first">Click the <strong>hackazon_vs</strong> to display Virtual Server Properties</p>
</li>
<li><p class="first">Click the <strong>Security-&gt;Policies</strong> tab to display Policy Settings</p>
</li>
<li><p class="first">In the <strong>Log Profile</strong> ensure <span class="guilabel">waf_log</span> profile is selected</p>
</li>
<li><p class="first">Select <strong>update</strong></p>
<a class="reference internal image-reference" href="../_images/image313.png"><img alt="../_images/image313.png" src="../_images/image313.png" style="height: 300px;" /></a>
</li>
<li><p class="first">Open browser and go to <span class="guilabel">http://&lt;f5student#-ext-pip0&gt;/product/view?id=101 or 1=1</span>.  You should receive a block message similar to below. Take note of the <strong>Support ID</strong> number.</p>
<a class="reference internal image-reference" href="../_images/image314.png"><img alt="../_images/image314.png" src="../_images/image314.png" style="height: 70px;" /></a>
</li>
<li><p class="first">Return to hackazon main page</p>
</li>
<li><p class="first">In the <strong>Search</strong> field type <span class="guilabel">&lt;script&gt;alert(&quot;Your system is infected! Call 999-888-7777 for help.&quot;)&lt;/script&gt;</span> and press <strong>Enter</strong>.  You should see a similar block message. Take note of the <strong>Support ID</strong> number.</p>
</li>
</ol>
<p><strong>Task 4 - Review WAF event logs on BIG-IP GUI.</strong></p>
<ol class="arabic">
<li><p class="first">Select the <strong>Security-&gt;Event Logs-&gt;Application-&gt;Requests</strong> page</p>
</li>
<li><p class="first">Select the <span class="guilabel">Event</span> with the matching <span class="guilabel">Support ID</span> noted on the block pages</p>
<a class="reference internal image-reference" href="../_images/image315.png"><img alt="../_images/image315.png" src="../_images/image315.png" style="height: 300px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can view the &quot;Decoded Requests&quot; and the &quot;Original Request&quot; however the &quot;Response&quot; is not captured by default.</p>
</div>
</li>
</ol>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="create-parent.html" title="Create WAF Parent Policy" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="update-parent.html" title="Update Parent WAF Policy" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../_static/js/index.js"></script>
  <script src="../_static/js/jquery.appear.js"></script>
  <script src="../_static/js/printThis.js"></script>
  <script src="../_static/js/bootstrap.min.js"></script>
  <script src="../_static/js/clouddocs.js"></script>
  <script src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>